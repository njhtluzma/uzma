<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pendaftaran Pembekal - Majlis Daerah Pengkalan Hulu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-blue: #003d82;
      --secondary-gold: #c9b037;
      --dark-blue: #002855;
      --light-gray: #f8f9fa;
      --border-color: #dee2e6;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .header-section {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
      color: white;
      padding: 30px;
      border-radius: 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }

    .header-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 300px;
      height: 300px;
      background: rgba(255,255,255,0.05);
      border-radius: 50%;
    }

    .header-section::after {
      content: '';
      position: absolute;
      bottom: -30%;
      left: -5%;
      width: 200px;
      height: 200px;
      background: rgba(255,255,255,0.03);
      border-radius: 50%;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 15px;
      position: relative;
      z-index: 1;
    }

    .logo-placeholder {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .logo-placeholder svg {
      width: 50px;
      height: 50px;
      fill: var(--primary-blue);
    }

    .header-title {
      flex: 1;
    }

    .header-title h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header-title p {
      margin: 5px 0 0 0;
      opacity: 0.95;
      font-size: 0.95rem;
    }

    .main-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .form-container {
      padding: 40px;
    }

    .section-title {
      color: var(--primary-blue);
      font-size: 1.1rem;
      font-weight: 600;
      margin: 30px 0 20px 0;
      padding-bottom: 10px;
      border-bottom: 3px solid var(--secondary-gold);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    .section-title svg {
      width: 24px;
      height: 24px;
      fill: var(--secondary-gold);
    }

    .form-label {
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    .form-control, .form-select {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px 15px;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 0.2rem rgba(0, 61, 130, 0.15);
    }

    .form-check {
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .form-check:hover {
      background: #f8f9fa;
    }

    .form-check-input {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      cursor: pointer;
      border: 2px solid #ccc;
    }

    .form-check-input:checked {
      background-color: var(--primary-blue);
      border-color: var(--primary-blue);
    }

    .form-check-label {
      cursor: pointer;
      margin-left: 8px;
      font-size: 0.95rem;
    }

    .required-star {
      color: #dc3545;
      margin-left: 3px;
    }

    .btn-submit {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
      border: none;
      padding: 15px 40px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 61, 130, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 61, 130, 0.4);
      background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 100%);
    }

    .btn-submit:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .alert {
      border-radius: 10px;
      border: none;
      padding: 20px;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .alert-success {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }

    .alert-danger {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: white;
    }

    .file-upload-wrapper {
      position: relative;
    }

    .file-upload-wrapper input[type="file"] {
      cursor: pointer;
    }

    .file-upload-wrapper input[type="file"]::file-selector-button {
      background: var(--primary-blue);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 15px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .file-upload-wrapper input[type="file"]::file-selector-button:hover {
      background: var(--dark-blue);
    }

    .info-banner {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-left: 4px solid var(--primary-blue);
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      font-size: 0.9rem;
      color: #1976d2;
    }
	
	@keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .table {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    .table thead {
      background: linear-gradient(135deg, #95A3AA 0%, #7a8a92 100%);
      color: white;
    }

    .table thead th {
      padding: 15px;
      font-weight: 600;
      border: none;
    }

    .table tbody tr {
      transition: all 0.2s ease;
    }

    .table tbody tr:hover {
      background-color: #f8f9fa;
      transform: scale(1.01);
    }

    .table tbody td {
      padding: 12px;
      vertical-align: middle;
    }

    .footer-text {
      text-align: center;
      padding: 20px;
      color: #666;
      font-size: 0.85rem;
      background: #f8f9fa;
      border-radius: 0;
    }

    @media (max-width: 768px) {
      .form-container {
        padding: 25px;
      }

      .header-section {
        padding: 20px;
      }

      .header-title h1 {
        font-size: 1.4rem;
      }

      .logo-section {
        flex-direction: column;
        text-align: center;
      }
    }

    .spinner-border-sm {
      width: 1.2rem;
      height: 1.2rem;
      border-width: 0.2em;
    }
  </style>
</head>
<body>

<div class="container" style="max-width: 1200px;">
  <div class="main-card">
    
    <!-- Header Section -->
    <div class="header-section">
      <div class="logo-section">
        <div class="logo-placeholder">
        <img src="https://drive.google.com/thumbnail?id=1t0yW_wCJF7Va86C6BYVtZWCn39RbPBvL&sz=00" alt="Logo MDPH" style="width: 80%; height: 80%; object-fit: contain;">
          </div>
        <div class="header-title">
          <h1>MAJLIS DAERAH PENGKALAN HULU</h1>
          <p>Sistem Pendaftaran Pembekal & Kontraktor</p>
        </div>
      </div>
    </div>

    <!-- Form Section -->
    <div class="form-container">
      
      <div class="info-banner">
        <strong>ðŸ“‹ Perhatian:</strong> Sila isi semua maklumat dengan lengkap dan tepat. Pastikan dokumen yang dimuat naik adalah sah dan jelas.
      </div>

      <form id="myForm">

        <!-- Bahagian 1: Jenis Pendaftaran -->
        <div class="section-title">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
          </svg>
          Maklumat Pendaftaran
        </div>

        <div class="mb-3">
          <label class="form-label">Jenis Pendaftaran<span class="required-star">*</span></label>
          <select name="pendaftaran" class="form-select" required>
            <option value="">-- Sila Pilih --</option>
            <option>Pendaftaran Baru</option>
            <option>Pendaftaran Semula</option>
          </select>
        </div>

        <div class="mb-4 file-upload-wrapper">
          <label class="form-label">Muat Naik Gambar Passport<span class="required-star">*</span></label>
          <input type="file" id="passport" accept="image/*" class="form-control" required>
          <small class="text-muted">Format: JPG, PNG | Maksimum: 5MB</small>
        </div>

        <!-- Bahagian 2: Maklumat Perniagaan -->
        <div class="section-title">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
          </svg>
          Maklumat Perniagaan
        </div>

        <div class="mb-3">
          <label class="form-label">Jenis Perniagaan<span class="required-star">*</span></label>
          <select name="jenis_perniagaan" class="form-select" required>
            <option value="">-- Sila Pilih --</option>
            <option>Bekalan</option>
            <option>Perkhidmatan</option>
            <option>Kerja</option>
            <option>Perunding</option>
          </select>
        </div>

        <div class="mb-4">
          <label class="form-label">Jenis Sijil yang Dimiliki</label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="jenis_sijil" value="SSM" id="sijil1">
            <label class="form-check-label" for="sijil1">
              Suruhanjaya Syarikat Malaysia (SSM)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="jenis_sijil" value="CIDB" id="sijil2">
            <label class="form-check-label" for="sijil2">
              Construction Industry Development Board (CIDB)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="jenis_sijil" value="MOF" id="sijil3">
            <label class="form-check-label" for="sijil3">
              Ministry of Finance (MOF)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="jenis_sijil" value="PKK" id="sijil4">
            <label class="form-check-label" for="sijil4">
              Pusat Khidmat Kontraktor (PKK)
            </label>
          </div>
        </div>

        <!-- Bahagian 3: Butiran Syarikat -->
        <div class="section-title">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
          </svg>
          Butiran Syarikat
        </div>

        <div class="mb-3">
          <label class="form-label">Nama Syarikat<span class="required-star">*</span></label>
          <input name="nama_syarikat" class="form-control" placeholder="Contoh: ABC Sdn Bhd" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Alamat Syarikat<span class="required-star">*</span></label>
          <textarea name="alamat" class="form-control" rows="3" placeholder="Masukkan alamat lengkap syarikat" required></textarea>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Bandar<span class="required-star">*</span></label>
            <input name="bandar" class="form-control" placeholder="Contoh: Pengkalan Hulu" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Negeri<span class="required-star">*</span></label>
            <select name="negeri" class="form-select" required>
              <option value="">-- Sila Pilih --</option>
              <option>Johor</option>
              <option>Kedah</option>
              <option>Kelantan</option>
              <option>Melaka</option>
              <option>Negeri Sembilan</option>
              <option>Pahang</option>
              <option>Perak</option>
              <option>Perlis</option>
              <option>Pulau Pinang</option>
              <option>Sabah</option>
              <option>Sarawak</option>
              <option>Selangor</option>
              <option>Terengganu</option>
              <option>WP Kuala Lumpur</option>
              <option>WP Labuan</option>
              <option>WP Putrajaya</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">No. Telefon<span class="required-star">*</span></label>
            <input name="telefon" type="tel" class="form-control" placeholder="Contoh: 012-3456789" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">No. Fax</label>
            <input name="fax" type="tel" class="form-control" placeholder="Contoh: 05-1234567">
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label">Alamat E-mel<span class="required-star">*</span></label>
          <input name="emel" type="email" class="form-control" placeholder="nama@gmail.com" required>
        </div>
		
		<!-- Bahagian 4: Maklumat Pengarah / Pemilik -->
        <div class="section-title">
          <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
			<path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm9 1.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 0-.5.5M9 8a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4A.5.5 0 0 0 9 8m1 2.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1h-3a.5.5 0 0 0-.5.5m-1 2C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1 1 0 0 0 2 13h6.96q.04-.245.04-.5M7 6a2 2 0 1 0-4 0 2 2 0 0 0 4 0 "/>
			</svg>Maklumat Pengarah / Pemilik
        </div>
		<div class="mb-3">
          <label class="form-label">Maklumat Pengarah / Pemilik<span class="required-star">*</span></label>
		 </div>
		<div class="table-responsive">
          <table class="table table-bordered">
            <thead style="background-color:#95A3AA">
              <tr class="text-center">
                <th>No</th>
                <th>Nama Penuh</th>
                <th>No. Kad Pengenalan</th>
                <th>Alamat</th>
                <th>Bandar</th>
                <th>Negeri</th>
                <th>Poskod</th>
                <th>Tambah</th>
              </tr>
            </thead>
            <tbody id="directorBody">
              <tr>
                <td class="text-center bil">1</td>
                <td><input type="text" class="form-control" name="pengarah_nama" required></td>
                <td><input type="text" class="form-control" name="pengarah_ic" required></td>
                <td><input type="text" class="form-control" name="pengarah_alamat" required></td>
                <td><input type="text" class="form-control" name="pengarah_bandar" required></td>
                <td><input type="text" class="form-control" name="pengarah_negeri" required></td>
                <td><input type="text" class="form-control" name="pengarah_poskod" required></td>
                <td class="text-center">
                  <button type="button" class="btn btn-success btn-sm" onclick="addDirectorRow()">+</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
		
		<div class="row mt-3">
          <div class="col-md-6 mb-3">
            <label class="form-label">No. Pendaftaran Syarikat<span class="required-star">*</span></label>
            <input type="text" class="form-control" name="no_pendaftaran_syarikat" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Taraf Syarikat<span class="required-star">*</span></label>
            <select class="form-select" name="taraf_syarikat" required>
              <option value="">-- Sila Pilih --</option>
              <option>Bumiputera</option>
              <option>Bukan Bumiputera</option>
              <option>Syarikat Luar Negeri</option>
			  <option>Syarikat/Agensi Kerajaan</option>
			  <option>Usahasama Berdaftar Di Malaysia</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Jenis Pendaftaran<span class="required-star">*</span></label>
            <select class="form-select" name="jenis_pendaftaran_syarikat" required>
              <option value="">-- Sila Pilih --</option>
              <option>Persendirian</option>
              <option>Perkongsian</option>
              <option>Sendirian Berhad</option>
              <option>Berhad</option>
            </select>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Tarikh Mula<span class="required-star">*</span></label>
            <input type="date" class="form-control" name="tarikh_mula" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Tarikh Tamat</label>
            <input type="date" class="form-control" name="tarikh_tamat">
          </div>
        </div>

        <h6 class="mt-4 fw-bold">Maklumat SSM</h6>

        <div class="row mt-3">
          <div class="col-md-6 mb-3">
            <label class="form-label">No. Pendaftaran<span class="required-star">*</span></label>
            <input type="text" class="form-control" name="ssm_no_pendaftaran" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Tarikh Daftar<span class="required-star">*</span></label>
            <input type="date" class="form-control" name="ssm_tarikh_daftar" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Tarikh Tamat Lesen<span class="required-star">*</span></label>
            <input type="date" class="form-control" name="ssm_tarikh_tamat" required>
          </div>
        </div>

        <div class="mb-4 file-upload-wrapper">
          <label class="form-label">Dokumen SSM<span class="required-star">*</span> <small>(Max 4)</small></label>
          <input type="file" class="form-control" id="dokumenSSM" multiple accept=".pdf,.jpg,.jpeg,.png" required>
        </div>

        <div class="border rounded p-3 bg-light mb-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="agreeSSM" name="agree_ssm" required>
            <label class="form-check-label" for="agreeSSM">
              Bahawasanya saya mengesahkan bahawa sepanjang pengetahuan dan kepercayaan saya semua butir-butir yang terkandung di dalam permohonan ini adalah benar dan tepat. Saya juga bersetuju untuk membenarkan tuan/puan melawat kemudahan -kemudahan yang ada serta menyemak butir-butir yang dikemukakan dalam borang ini. Sekiranya butir-butir yang diberi di atas tidak benar, saya bersetuju bahawa permohonan saya boleh ditolak atau atas sekiranya telah didaftar, pendaftaran tersebut boleh ditamatkan dengan serta merta.
            </label>
          </div>
        </div>

        <h6 class="mt-4 fw-bold">Kementerian Kewangan Malaysia <small>(Jika Ada)</small></h6>

        <div class="row mt-3">
          <div class="col-md-4 mb-3">
            <label class="form-label">No. Sijil</label>
            <input type="text" class="form-control" name="mof_no_sijil">
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">No. Rujukan</label>
            <input type="text" class="form-control" name="mof_no_rujukan">
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Tempoh Sah Laku</label>
            <input type="date" class="form-control" name="mof_tempoh_sah">
          </div>
        </div>

        <h6 class="mt-4 fw-bold">Maklumat CIDB</h6>

        <div class="row mt-3">
          <div class="col-md-4 mb-3">
            <label class="form-label">No. Pendaftaran<span class="required-star">*</span></label>
            <input type="text" class="form-control" name="cidb_no_pendaftaran" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Tarikh Daftar<span class="required-star">*</span></label>
            <input type="date" class="form-control" name="cidb_tarikh_daftar" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Tarikh Tamat<span class="required-star">*</span></label>
            <input type="date" class="form-control" name="cidb_tarikh_tamat" required>
          </div>
        </div>

        <table class="table table-bordered">
          <thead style="background-color:#95A3AA">
            <tr class="text-center">
              <th>Pilih</th>
              <th>Kelas</th>
              <th>Harga (RM)</th>
            </tr>
          </thead>
          <tbody>
            <tr class="text-center">
              <td><input type="radio" name="cidb_gred" value="G1|50" required></td>
              <td>GRED G1</td>
              <td>50.00</td>
            </tr>
            <tr class="text-center">
              <td><input type="radio" name="cidb_gred" value="G2|75"></td>
              <td>GRED G2</td>
              <td>75.00</td>
            </tr>
            <tr class="text-center">
              <td><input type="radio" name="cidb_gred" value="G3|100"></td>
              <td>GRED G3</td>
              <td>100.00</td>
            </tr>
            <tr class="text-center">
              <td><input type="radio" name="cidb_gred" value="G4/G5|150"></td>
              <td>GRED G4/G5</td>
              <td>150.00</td>
            </tr>
            <tr class="text-center">
              <td><input type="radio" name="cidb_gred" value="G6/G7|250"></td>
              <td>GRED G6/G7</td>
              <td>250.00</td>
            </tr>
          </tbody>
        </table>

        <div class="mb-4 file-upload-wrapper">
          <label class="form-label">Dokumen CIDB<span class="required-star">*</span> <small>(Max 4)</small></label>
          <input type="file" class="form-control" id="dokumenCIDB" multiple accept=".pdf,.jpg,.jpeg,.png" required>
        </div>

        <button class="btn btn-primary btn-submit w-100" type="submit" id="submitBtn">
          <span id="btnText">Hantar Permohonan</span>
          <span id="btnSpinner" class="spinner-border spinner-border-sm d-none ms-2" role="status"></span>
        </button>
      </form>

      <!-- Success Message -->
      <div id="successMsg" class="alert alert-success mt-4 d-none">
        <strong>âœ“ Berjaya!</strong> Permohonan anda telah berjaya dihantar. Terima kasih.
      </div>

      <!-- Error Message -->
      <div id="errorMsg" class="alert alert-danger mt-4 d-none">
        <strong>âœ— Ralat!</strong> <span id="errorText">Sila cuba lagi.</span>
      </div>

    </div>

    <div class="footer-text">
      <strong>Majlis Daerah Pengkalan Hulu</strong><br>
      Hulu Perak, Perak Darul Ridzuan<br>
      Â© 2024 Hak Cipta Terpelihara
    </div>

  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzli94S5XpWVBtq5zWMj3wRkLjICL3vP2D6B6vmyMrmyhe9RLPzY5tSscX1lDJJDNk/exec";

function addDirectorRow() {
  const tbody = document.getElementById("directorBody");
  const rowCount = tbody.rows.length + 1;
  const row = document.createElement("tr");
  row.innerHTML = `
    <td class="text-center bil">${rowCount}</td>
    <td><input type="text" class="form-control" name="pengarah_nama" required></td>
    <td><input type="text" class="form-control" name="pengarah_ic" required></td>
    <td><input type="text" class="form-control" name="pengarah_alamat" required></td>
    <td><input type="text" class="form-control" name="pengarah_bandar" required></td>
    <td><input type="text" class="form-control" name="pengarah_negeri" required></td>
    <td><input type="text" class="form-control" name="pengarah_poskod" required></td>
    <td class="text-center">
      <button type="button" class="btn btn-danger btn-sm" onclick="removeDirectorRow(this)">âˆ’</button>
    </td>
  `;
  tbody.appendChild(row);
}

function removeDirectorRow(btn) {
  btn.closest("tr").remove();
  document.querySelectorAll(".bil").forEach((el, i) => el.innerText = i + 1);
}

async function convertFileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(",")[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

document.getElementById("myForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const submitBtn = document.getElementById("submitBtn");
  const btnText = document.getElementById("btnText");
  const btnSpinner = document.getElementById("btnSpinner");
  const successMsg = document.getElementById("successMsg");
  const errorMsg = document.getElementById("errorMsg");
  const errorText = document.getElementById("errorText");

  submitBtn.disabled = true;
  btnText.textContent = "Sedang menghantar...";
  btnSpinner.classList.remove("d-none");
  successMsg.classList.add("d-none");
  errorMsg.classList.add("d-none");

  try {
    const formData = new FormData(this);
    const payload = {};

    // Collect all checked sijil values
    const checkedSijil = [];
    document.querySelectorAll('input[name="jenis_sijil"]:checked').forEach(checkbox => {
      checkedSijil.push(checkbox.value);
    });
    payload.jenis_sijil = checkedSijil.join(", ");

    for (let [key, value] of formData.entries()) {
      if (key === "jenis_sijil") {
        // Skip - already handled above
        continue;
      } else if (key.startsWith("pengarah_")) {
        if (!payload[key]) payload[key] = [];
        payload[key].push(value);
      } else {
        payload[key] = value;
      }
    }

    // Handle Passport file
    const passportInput = document.getElementById("passport");
    const passportFile = passportInput.files[0];
    
    if (!passportFile) {
      throw new Error("Sila muat naik gambar passport");
    }
    if (passportFile.size > 5 * 1024 * 1024) {
      throw new Error("Saiz passport terlalu besar (Max 5MB)");
    }
    
    const passportBase64 = await convertFileToBase64(passportFile);
    payload.passportData = passportBase64;
    payload.passportName = passportFile.name;
    payload.passportType = passportFile.type;

    // Handle SSM files
    const ssmFiles = document.getElementById("dokumenSSM").files;
    if (ssmFiles.length === 0) throw new Error("Sila muat naik dokumen SSM");
    if (ssmFiles.length > 4) throw new Error("Maksimum 4 fail SSM");
    
    payload.ssmFilesData = [];
    for (let i = 0; i < ssmFiles.length; i++) {
      const file = ssmFiles[i];
      payload.ssmFilesData.push({
        data: await convertFileToBase64(file),
        name: file.name || `ssm_${i+1}.pdf`,
        type: file.type || "application/pdf"
      });
    }

    // Handle CIDB files
    const cidbFiles = document.getElementById("dokumenCIDB").files;
    if (cidbFiles.length === 0) throw new Error("Sila muat naik dokumen CIDB");
    if (cidbFiles.length > 4) throw new Error("Maksimum 4 fail CIDB");
    
    payload.cidbFilesData = [];
    for (let i = 0; i < cidbFiles.length; i++) {
      const file = cidbFiles[i];
      payload.cidbFilesData.push({
        data: await convertFileToBase64(file),
        name: file.name || `cidb_${i+1}.pdf`,
        type: file.type || "application/pdf"
      });
    }

    const response = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(payload)
    });

    const result = await response.json();

    if (result.status === "success") {
      successMsg.classList.remove("d-none");
      this.reset();
      window.scrollTo({ top: 0, behavior: "smooth" });
      setTimeout(() => successMsg.classList.add("d-none"), 5000);
    } else {
      throw new Error(result.message || "Ralat tidak diketahui");
    }

  } catch (error) {
    console.error(error);
    errorText.textContent = error.message;
    errorMsg.classList.remove("d-none");
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  } finally {
    submitBtn.disabled = false;
    btnText.textContent = "Hantar Permohonan";
    btnSpinner.classList.add("d-none");
  }
});
</script>

</body>
</html>
